---
title: "Indicators"
output:
  html_document: 
    code_folding: hide
    toc: true
    toc_float: true
    css: mystyle.css
---

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE
)
```

An explanation of what indicators are and of the reason why they are widely used in companies and international organizations will be provided. The latest developments in methodology for the construction of indexes and indicators will be explained (economic activity, human development, poverty, finance, etc.). Special attention will be paid to their application in decision-making processes and, more precisely, to their usefulness in the context of forecasting. In particular, the methodology applied by international institutions in the construction of the most commonly known indexes will be explained, identifying and providing potential improvements. Students will solve a case study based on the real situation of an international institution using indicators.

## Indicators

This page contains a combination of traditional lecture materials (slides) and code demonstrating the relevant methods. The short course will proceed by working through both. We will use several recent packages in our examples; see the [About](./About.html) page for information about the package versions.

```{r setup}
library(tidyverse)
library(grpreg)
library(splines)
library(refund)
library(refund.shiny)
```

In this section we'll use the [DTI dataset](./Data.html) to motivate the scalar-on-function regression model and variable selection in this context. Our main outcome of interest is multiple sclerosis case status, and the possible predictors are tract profiles from several major white matter structures. Below we plot profiles for one tract colored by MS case status.

```{r DTI_explore, eval = TRUE}
load("./DataCode/DTI.RDA")

as_refundObj(CCA_ani) %>% 
	left_join(dplyr::select(outcome_data, id, case)) %>%
	ggplot(aes(x = index, y = value, group = id, color = case)) + geom_path(alpha = .5)
```

## Variable selection

Slides below review scalar-on-function regression and introduce the ideas for variable selection in this context.

## Practical example

Some DTI profiles are incomplete; we can use FPCA to obtain estimates over a complete domain.

```{r DTI_sofr_varselect, eval = TRUE}
fpca_ex = fpca.sc(CSTL_ani)

bind_rows(as_refundObj(fpca_ex$Y) %>% mutate(type = "Observed"),
					as_refundObj(fpca_ex$Yhat) %>% mutate(type = "Fitted")) %>%
	ggplot(aes(x = index, y = value, group = id)) + geom_path(alpha = .5) +
		facet_grid(~type)
```

(Incidentally, the `refund.shiny` package has helpful tools for visualizing the results of an FPCA analysis. More information about the package can be found [here](https://github.com/refunders/refund.shiny).)

```{r plot_shiny_fpca, eval = FALSE}
plot_shiny(fpca_ex)
```

Several steps are needed to organize the functional predictors to fit the scalar-on-function regression with variable selection. In particular, for this dataset we use FPCA on each predictor; scale the resulting reconstructions; and combine with a spline basis. The code below implements these steps and produces a list containing the result for each predictor.

The panels below show the results of the preceding model fit for two values of the tuning parameter. For each, estimated spline coefficients are combined with the spline basis to produce the coefficient function.

## Try it yourself!

Another example for variable selection in the scalar-on-function regression setting is the [Sugar dataset](./DataCode.html). In this example, predicting the ash content of a sugar sample based on emission spectra at several wavelengths (and on the derivatives of these spectra) is of interest. 

Below we plot the spectra at a single wavelength colored by ash content. 

```{r Sugar_explore, eval = TRUE}
load("./DataCode/Sugar.RDA")

as_refundObj(wave_230) %>% 
	left_join(dplyr::select(outcome_data, id, ash)) %>%
	ggplot(aes(x = index, y = value, group = id, color = ash)) + geom_path(alpha = .5)
```
